<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang | default "en" }}">
<head>
  {{/* Prevent flash of wrong theme - must be before any CSS */}}
  <script>
    (function() {
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  {{ partial "head.html" . }}
</head>
<body>
  {{ partial "header.html" . }}

  <main class="main-content">
    {{ block "main" . }}{{ end }}
  </main>

  {{ partial "footer.html" . }}

  <script>
    // Theme toggle
    (function() {
      const toggle = document.querySelector('.theme-toggle');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      }

      toggle.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme');
        setTheme(current === 'dark' ? 'light' : 'dark');
      });

      // Listen for system preference changes
      prefersDark.addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          setTheme(e.matches ? 'dark' : 'light');
        }
      });
    })();

    // Mobile menu toggle
    (function() {
      const toggle = document.querySelector('.menu-toggle');
      const menu = document.querySelector('.nav-menu');

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', !expanded);
        menu.classList.toggle('open');
      });
    })();

    // Copy code button - add to .highlight wrappers (Hugo's syntax highlighting)
    document.querySelectorAll('.highlight').forEach((highlight) => {
      const code = highlight.querySelector('code');
      if (!code) return;

      const button = document.createElement('button');
      button.className = 'copy-btn';
      button.textContent = 'Copy';
      button.addEventListener('click', async () => {
        await navigator.clipboard.writeText(code.textContent);
        button.textContent = 'Copied!';
        setTimeout(() => button.textContent = 'Copy', 2000);
      });
      highlight.appendChild(button);
    });
  </script>
</body>
</html>
